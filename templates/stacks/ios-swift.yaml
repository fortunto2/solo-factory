name: iOS Swift
platform: ios
language: swift6
ui_framework: swiftui
build: xcode
project_gen: xcodegen (project.yml → .xcodeproj, never commit .xcodeproj)
package_manager: spm
auth: shared-auth (SharedAuth Swift Package)
payments: storekit2
validation: "Codable + custom validation (protocol-based)"
i18n: string_catalog (.xcstrings, Xcode 16 native)
linter: swiftlint (SPM plugin or Homebrew)
formatter: swift-format (Apple, SPM plugin)
testing: XCTest + Swift Testing
pre_commit: none (Xcode build phases for SwiftLint)
key_packages:
  - SwiftUI
  - SwiftData (local persistence, NOT Core Data for new projects)
  - CoreML
  - Vision (face detection)
  - StoreKit 2 (IAP)
  - SharedAuth (shared auth)
  - SwiftLint (linter)
  - PostHog (analytics, posthog-ios SPM)
deploy: app_store
infra: none (native store distribution)
ci_cd: github_actions (xcodebuild + fastlane)
monitoring: posthog (analytics + errors, posthog-ios SPM)
architecture: MVVM

# Patterns learned from real projects via SoloGraph
patterns:
  viewmodel: |
    @Observable @MainActor final class — NOT ObservableObject.
    Init injection for services (DI). Use @State in views.
    Example: @State private var viewModel = MyViewModel()
  services: |
    actor for heavy/ML services (thread safety for models).
    @Observable @MainActor final class for UI-facing services (recording, audio).
    Always create protocol: Services/Protocols/FooServiceProtocol.swift.
    Protocol enables mocking in tests and swapping implementations.
  models: |
    SwiftData @Model for persistent data (NOT Core Data, NOT Codable struct).
    Plain structs for transient data (configs, settings, API responses).
  permissions: |
    Always request permissions before use — never assume granted.
    Pattern: requestPermission() async -> Bool in the service protocol.
    Show alert with "Open Settings" button when denied.
    Use #if os(iOS) for AVAudioSession (unavailable on macOS).
  directory_structure: |
    App/           — @main entry point
    Models/        — @Model schemas (SwiftData)
    Views/         — SwiftUI views
    ViewModels/    — @Observable @MainActor view models
    Services/      — Business logic (actors + @Observable classes)
    Services/Protocols/  — Service protocols for DI
    Extensions/    — String+, Date+, etc.
    Resources/     — Assets.xcassets, etc.
  concurrency: |
    @MainActor on all ViewModels and UI-facing services.
    actor for data/ML services (own isolation domain).
    async/await everywhere, no Combine for new code.
    Timer callbacks: Task { @MainActor in ... } for safety.

xcodegen_required:
  info_plist:
    UISupportedInterfaceOrientations:
      - UIInterfaceOrientationPortrait
      - UIInterfaceOrientationPortraitUpsideDown
      - UIInterfaceOrientationLandscapeLeft
      - UIInterfaceOrientationLandscapeRight
    UILaunchScreen: {}
    UIApplicationSceneManifest:
      UIApplicationSupportsMultipleScenes: true
  bundle_id: "<org_domain>.<name>"
  build_settings:
    PRODUCT_BUNDLE_IDENTIFIER: "<org_domain>.<name>"
    MARKETING_VERSION: "1.0.0"
    CURRENT_PROJECT_VERSION: "1"
    DEVELOPMENT_TEAM: <apple_dev_team>
    CODE_SIGN_STYLE: Automatic
  archive_command: |
    xcodegen generate
    xcodebuild archive -scheme <Name> -destination 'generic/platform=iOS' -archivePath build/<Name>.xcarchive
    open build/<Name>.xcarchive  # → Distribute App

notes: |
  - Prefer SwiftUI over UIKit for new views
  - Use async/await (Swift 6 strict concurrency)
  - Use @Observable (NOT ObservableObject) — Swift 6 pattern
  - @MainActor on ViewModels and UI services
  - actor for ML/data services (thread safety)
  - Protocol for every service (DI, testability)
  - Local-first: SwiftData (NOT Core Data, NOT Firebase)
  - XcodeGen project.yml — never commit .xcodeproj
  - String Catalog for i18n (Xcode 16 native, .xcstrings)
  - SwiftLint for linting (SPM plugin or build phase)
  - swift-format for consistent formatting
  - Swift Testing (@Test) for new tests, XCTest for legacy
  - English first, then localize
  - StoreKit 2 for in-app purchases and subscriptions
  - #if os(iOS) for AVAudioSession, UIApplication (macOS compat)
  - PostHog for analytics (privacy-respecting, EU hosting)
